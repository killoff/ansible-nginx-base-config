# DO NOT EDIT - MAINTAINED BY ANSIBLE
# https://github.com/ufirstgroup/ansible-nginx-base-config

set_by_lua $request_id '
    local function random_id()
        local charset = "0123456789abcdefghijklmnopqrstuvwxyz"
        local range = charset:len()

        local part_1 = {}
        local part_2 = {}

        for loop = 1,8 do
            part_1[loop] = string.char(charset:byte(math.random(1, range)))
            part_2[loop] = string.char(charset:byte(math.random(1, range)))
        end

        return ngx.worker.pid() .. "-" .. table.concat(part_1) .. "-" .. table.concat(part_2)
    end

    local request_id = random_id()

    -- add header to request (this is a lua comment ...)
    ngx.req.set_header("X-Request-ID", request_id)
    return request_id
';

# adding a header to a request without lua is a bit more complicated:
# proxy_set_header X-Request-ID $request_id;
# fastcgi_param HTTP_X_REQUEST_ID $request_id;
# ... maybe more

# add header to response
add_header X-Request-ID $request_id always;
