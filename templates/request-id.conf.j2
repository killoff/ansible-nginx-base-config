# DO NOT EDIT - MAINTAINED BY ANSIBLE
# https://github.com/ufirstgroup/ansible-nginx-base-config

set_by_lua $request_id '
    local function random_id()
        local charset = "0123456789abcdefghijklmnopqrstuvwxyz"
        local template = "xxxx-xxxxxxxx-xxxxxxxx"
        local range = charset:len()
        return ngx.worker.pid() .. "-" .. string.gsub(template, "x", function (c)
            return string.char(charset:byte(math.random(1, range)))
        end)
    end
    local request_id = random_id()
    -- add header to request (this is a lua comment ...)
    ngx.req.set_header("X-Request-ID", request_id)
    return request_id
';

# adding a header to a request without lua is a bit more complicated:
# proxy_set_header X-Request-ID $request_id;
# fastcgi_param HTTP_X_REQUEST_ID $request_id;
# ... maybe more

# add header to response
add_header X-Request-ID $request_id always;
